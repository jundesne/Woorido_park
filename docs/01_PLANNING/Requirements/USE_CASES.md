# WOORIDO 유스케이스 (Use Cases)

**작성일**: 2026-01-06
**목적**: 사용자 중심의 기능 시나리오 정의
**버전**: v2.1 - Challenge 용어 기반

---

## 📋 유스케이스 개요

### 주요 액터 (Actors)

| 액터 | 설명 | 권한 |
|------|------|------|
| **리더** (Leader) | 챌린지 생성자 | 챌린지 관리, 정기 모임 생성 투표 발의, 오픈 사용 신청 |
| **팔로워** (Follower) | 챌린지 참여자 | 피드 작성, 투표 참여, 오픈 사용 신청 |
| **미가입 유저** | 로그인만 한 상태 | 챌린지 탐색, 가입 신청 |
| **시스템** | 자동화 작업 | 참가비 자동 차감, 투표 자동 만료, Django 분석 |

---

## 🎯 핵심 유스케이스 (Core Use Cases)

### UC-01: 챌린지 생성

**액터**: 리더 (되고자 하는 유저)
**전제조건**: 로그인 상태, 우리두 어카운트 생성됨
**성공 시나리오**:

1. 유저가 "챌린지 시작하기" 클릭
2. 챌린지 정보 입력
   - 이름: "책 읽기 챌린지"
   - 카테고리: STUDY
   - 월 참가비: 100,000원
   - 보증금: 100,000원 (자동 계산: = 참가비)
   - 최대 인원: 10명
   - 설명: "매주 한 권씩 읽고 후기 공유"
3. 시스템이 유효성 검증 (참가비 >= 10,000원, 최대 인원 >= 2명)
4. 챌린지 생성 완료 → **상태: RECRUITING** (모집 중)
5. **리더가 자동으로 첫 번째 멤버로 등록** (<<include>> 관계)
   - ⚠️ RECRUITING 상태에서는 보증금 락 없음 (P-046)
6. 챌린지 홈으로 이동
7. 리더가 첫 번째 공지사항 작성

**사후조건**:
- 챌린지 레코드 생성 (DB)
- **챌린지 상태**: RECRUITING
- **리더의 보증금 락**: 없음 (RECRUITING 상태)
- 리더가 자동으로 첫 번째 멤버로 등록
- 리더가 챌린지 홈에 진입 가능

**상태 전환 조건** (P-047):
- **3번째 멤버 가입 시** → 자동 ACTIVE 전환
- ACTIVE 전환 시 activated_at 기록 (입회비 3개월 계산 기준)
- ACTIVE 전환 알림: "챌린지가 시작되었습니다! 다음 달 1일부터 서포트 납입이 시작됩니다."

**대안 시나리오**:
- 3a. 참가비 < 10,000원 → "최소 참가비는 10,000원입니다" 에러
- 3b. 최대 인원 < 3명 → "최소 인원은 3명입니다" 에러 (리더 포함)

> 💡 **UML 다이어그램 관계**:
> - 챌린지 생성 --`<<include>>`--> 챌린지 가입 (리더 자동 가입, 필수)
> - 챌린지 생성은 리더 가입 없이 완료될 수 없음

---

### UC-02-0: 챌린지 상세 모달 조회 (메인페이지)

**액터**: 모든 유저 (비회원 포함)
**전제조건**: 메인페이지 접속
**성공 시나리오**:

1. 유저가 메인페이지 "추천 챌린지" 섹션 확인
2. 챌린지 배너 클릭 (예: "책벌레들")
3. **챌린지 상세 모달 팝업** (전체화면 오버레이)
   ```
   ╔══════════════════════════════════════════╗
   ║  📖 책벌레들                           ✕  ║
   ╠══════════════════════════════════════════╣
   ║                                          ║
   ║  [챌린지 썸네일 이미지]                  ║
   ║                                          ║
   ║  📊 참여 인원: 8/10명                   ║
   ║  💰 월 참가비: 100,000원                ║
   ║  🔒 보증금: 100,000원 (미납 시 충당)     ║
   ║  📅 시작일: 2026-01-15                  ║
   ║  📝 설명: 매주 한 권씩 읽고 후기 공유... ║
   ║                                          ║
   ║  [참여하기]                              ║
   ║                                          ║
   ╚══════════════════════════════════════════╝
   ```
4. 모달에서 챌린지 정보 확인
   - 썸네일 이미지
   - 참여 인원 (8/10명)
   - 월 참가비 (100,000원)
   - 보증금 (100,000원)
   - 입회비 (현재 멤버 수 기준 계산)
   - 챌린지 설명
   - 시작일

**사후조건**:
- 모달 표시됨
- 사용자가 "참여하기" 또는 "닫기" 선택 가능

**다음 유스케이스**:
- "참여하기" 클릭 → **UC-02 챌린지 참여**로 이동
- "✕" 또는 모달 외부 클릭 → 모달 닫기

---

### UC-02: 챌린지 참여 (가입)

**액터**: 팔로워 (되고자 하는 유저), 비회원
**전제조건**: 챌린지 상세 모달에서 "참여하기" 클릭 (UC-02-0)
**성공 시나리오**:

> ⚠️ **챌린지 상태에 따라 납입 금액이 다릅니다** (P-046, P-047, P-027):
> - **RECRUITING**: 보증금 락 없음, 입회비 없음
> - **ACTIVE (3개월 미만)**: 보증금 락만
> - **ACTIVE (3개월 이상)**: 보증금 락 + 입회비

**[분기 1] 비회원인 경우**:
1. "참여하기" 클릭
2. 시스템이 로그인 상태 확인 → **미로그인**
3. 로그인/회원가입 선택 모달 표시
   ```
   ⚠️ 로그인이 필요합니다

   챌린지에 참여하려면 로그인이 필요합니다.

   [로그인]  [회원가입]
   ```
4. "로그인" 또는 "회원가입" 선택
5. 로그인/회원가입 완료 후 → **챌린지 상세 모달로 리턴**
6. 다시 "참여하기" 클릭 → **[분기 2]로 진행**

**[분기 2] 회원인 경우 (로그인 상태)**:

시스템이 **챌린지 상태 확인** 후 분기 처리:

---

**[분기 2-A] RECRUITING 상태 챌린지 가입** (P-046):

1. "참여하기" 클릭
2. 시스템이 챌린지 상태 확인 → **RECRUITING**
3. 참여 확인 모달 표시
   ```
   ❓ 정말로 참여하시겠습니까?

   📖 책벌레들 챌린지에 참여합니다.

   총 필요 금액: 0원 ✅
   - 보증금 락: 없음 (RECRUITING 상태)
   - 입회비: 없음 (RECRUITING 상태)

   💡 3명 모집 완료 시 챌린지가 시작됩니다.

   [취소]  [확인]
   ```
4. "확인" 클릭
5. 챌린지 멤버 추가
6. **3명 달성 시** → 자동 ACTIVE 전환 (P-047)
   ```
   🎉 챌린지가 시작되었습니다!

   다음 달 1일부터 서포트 납입이 시작됩니다.
   보증금 락: 100,000원
   ```
7. 챌린지 홈 진입

**사후조건**:
- 팔로워로 등록됨
- 보증금 락: 없음 (RECRUITING) 또는 자동 락 (ACTIVE 전환 시)
- 챌린지 금고 잔액: 변동 없음

---

**[분기 2-B] ACTIVE 상태 (3개월 미만) 챌린지 가입** (P-048):

1. "참여하기" 클릭
2. 시스템이 챌린지 상태 확인 → **ACTIVE**, activated_at 기준 2개월 경과
3. 참여 확인 모달 표시
   ```
   ❓ 정말로 참여하시겠습니까?

   📖 책벌레들 챌린지에 참여합니다.

   총 필요 금액: 100,000원
   - 보증금 락: 100,000원
   - 입회비: 없음 (3개월 미만)

   [취소]  [확인]
   ```
4. "확인" 클릭
5. 시스템이 **어카운트 잔액 확인**
   - 가용 잔액: 150,000원 ✅ (충분)
6. 보증금 락 처리
   - 개인 어카운트 locked_balance: +100,000원
7. 챌린지 멤버 추가 → 챌린지 홈 진입

**사후조건**:
- 팔로워로 등록됨
- 보증금 락: 100,000원
- 챌린지 금고 잔액: 변동 없음

---

**[분기 2-C] ACTIVE 상태 (3개월 이상) 챌린지 가입** (P-027, P-048):

1. "참여하기" 클릭
2. 시스템이 챌린지 상태 확인 → **ACTIVE**, activated_at 기준 4개월 경과
3. **입회비 계산** (P-027):
   - 챌린지 금고 잔액: 3,000,000원
   - 현재 멤버 수: 8명 (리더 포함)
   - 입회비 = 3,000,000 / (8 - 1) = 428,571원
4. 참여 확인 모달 표시
   ```
   ❓ 정말로 참여하시겠습니까?

   📖 책벌레들 챌린지에 참여합니다.

   총 필요 금액: 528,571원
   - 보증금 락: 100,000원
   - 입회비: 428,571원

   💡 입회비는 기존 팔로워들이 쌓아놓은 자산의
      공정한 분담금입니다. 탈퇴 시 반환되지 않습니다.

   [취소]  [확인]
   ```
5. "확인" 클릭
6. 시스템이 **어카운트 잔액 확인**
   - 가용 잔액: 600,000원 ✅ (충분)
7. 결제 처리
   - 보증금 락: +100,000원 (개인 어카운트 locked_balance)
   - 입회비: -428,571원 (개인 어카운트 balance)
   - 챌린지 금고 입금: +428,571원
8. 챌린지 멤버 추가 → 챌린지 홈 진입

**사후조건**:
- 팔로워로 등록됨
- 보증금 락: 100,000원
- 챌린지 금고 잔액: 3,428,571원으로 증가
- 거래 내역에 입회비 기록

**대안 시나리오**:

- **5a. 어카운트 잔액 부족** → 충전 플로우로 이동
  1. 잔액 부족 안내 모달 표시
     ```
     ⚠️ 잔액이 부족합니다

     현재 잔액: 200,000원
     필요 금액: 475,000원
     부족 금액: 275,000원

     [충전하기]  [취소]
     ```
  2. "충전하기" 클릭 → 충전 화면으로 이동
  3. 충전 완료 → **챌린지 상세 모달로 자동 리턴**
  4. "참여하기" 버튼 다시 활성화
  5. 다시 "참여하기" 클릭 → 정상 진행 (step 3부터)

- **8a. 최대 인원 초과** (Race Condition)
  - "인원이 마감되었습니다" 에러
  - 모달 닫기, 챌린지 목록으로 복귀

---

### UC-03: SNS 피드 작성

**액터**: 리더 또는 팔로워
**전제조건**: 챌린지 멤버
**성공 시나리오**:

1. 챌린지 홈 → "피드" 탭
2. 피드 작성 버튼 클릭
3. 내용 입력
   - 텍스트: "이번 주에 읽은 책 '미드나잇 라이브러리' 후기"
   - 이미지: 책 사진 업로드 (최대 10장)
4. "게시" 클릭
5. S3에 이미지 업로드
6. 피드 저장 → 피드 목록 최상단에 표시
7. 다른 팔로워들에게 알림 (선택적)

**사후조건**:
- 피드 레코드 생성
- 이미지 S3에 저장
- 피드 목록에 표시

**대안 시나리오**:
- 5a. 이미지 업로드 실패 → 텍스트만 게시 옵션 제공
- 5b. 네트워크 오류 → "다시 시도" 버튼

---

### UC-03-1: 공지사항 수정/삭제 (NEW)

**액터**: 리더 (공지사항 작성자)
**전제조건**: 본인이 작성한 공지사항, 챌린지 멤버
**성공 시나리오**:

**[수정]**:
1. 리더가 자신이 작성한 공지사항 클릭
2. "⋮" 메뉴 → "수정" 선택
3. 피드 편집 화면으로 이동
   - 기존 텍스트/이미지 표시
4. 내용 수정 (텍스트/이미지 추가/삭제)
5. "수정 완료" 클릭
6. 시스템이 updated_at 갱신
7. 피드 목록에서 "(수정됨)" 표시
8. **모든 챌린지 멤버에게 알림**
   - "공지사항이 수정되었습니다"

**[삭제]**:
1. 리더가 자신이 작성한 공지사항 클릭
2. "⋮" 메뉴 → "삭제" 선택
3. 확인 모달 표시
   ```
   ⚠️ 공지사항 삭제

   공지사항을 삭제하시겠습니까?
   삭제된 공지사항은 복구할 수 없습니다.

   [취소]  [삭제]
   ```
4. "삭제" 확인
5. 시스템이 soft delete 처리 (deleted_at 기록)
6. 핀 고정 자동 해제 (is_pinned = false)
7. 피드 목록에서 제거

**사후조건**:
- [수정] updated_at 갱신, 알림 전송
- [삭제] deleted_at 기록, 핀 고정 해제

**대안 시나리오**:
- 1a. 다른 사람의 공지사항 → "수정/삭제" 메뉴 미표시
- 1b. 일반 리더 권한이지만 작성자가 아님 → 권한 없음

---

### UC-04: 댓글 작성

**액터**: 리더 또는 팔로워
**전제조건**: 챌린지 멤버
**성공 시나리오**:

1. 피드 카드 → "댓글" 영역 클릭
2. 댓글 입력: "저도 읽었는데 정말 감동적이었어요!"
3. "작성" 클릭
4. 댓글 저장 → 피드 아래 표시
5. 피드 작성자에게 알림

**대댓글**:
1. 기존 댓글 → "답글" 클릭
2. 대댓글 입력: "@user 맞아요! 특히 결말이..."
3. 대댓글 저장 → 원댓글 아래 표시 (들여쓰기)

**사후조건**:
- 댓글 레코드 생성
- 피드 comment_count +1
- 작성자에게 알림

---

### UC-04-1: 댓글/대댓글 삭제 (NEW)

**액터**: 댓글 작성자 또는 리더
**전제조건**: 본인이 작성한 댓글 또는 리더 권한
**성공 시나리오**:

**[일반 댓글 삭제 - 대댓글 없음]**:
1. 댓글 작성자 또는 리더가 댓글 "⋮" 메뉴 클릭
2. "삭제" 선택
3. 확인 모달 표시
   ```
   ⚠️ 댓글 삭제

   댓글을 삭제하시겠습니까?

   [취소]  [삭제]
   ```
4. "삭제" 확인
5. 시스템이 댓글 완전 삭제 (hard delete)
6. 피드 comment_count -1
7. 댓글 목록에서 즉시 제거

**[일반 댓글 삭제 - 대댓글 있음]**:
1. 댓글 작성자 또는 리더가 댓글 "⋮" 메뉴 클릭
2. "삭제" 선택
3. 확인 모달 표시 (대댓글 존재 안내)
   ```
   ⚠️ 댓글 삭제

   이 댓글에 대댓글이 있습니다.
   삭제하시겠습니까?

   [취소]  [삭제]
   ```
4. "삭제" 확인
5. 시스템이 soft delete 처리 (deleted_at 기록)
6. 댓글 내용 → **"삭제된 댓글입니다"** 표시
7. 대댓글은 유지되어 표시됨

**[대댓글 삭제]**:
1. 대댓글 작성자 또는 리더가 대댓글 "⋮" 메뉴 클릭
2. "삭제" 선택
3. 확인 모달 표시
4. "삭제" 확인
5. 대댓글 완전 삭제 (hard delete)
6. 원댓글의 reply_count -1
7. 대댓글 목록에서 즉시 제거
8. **원댓글이 "삭제된 댓글"이고 대댓글이 0개가 되면** → 원댓글도 완전 삭제

**사후조건**:
- 대댓글 없는 댓글: 완전 삭제
- 대댓글 있는 댓글: soft delete, "삭제된 댓글입니다" 표시
- 대댓글: 완전 삭제

**대안 시나리오**:
- 1a. 다른 사람의 댓글 + 일반 팔로워 → "삭제" 메뉴 미표시
- 1b. 다른 사람의 댓글 + 리더 권한 → "삭제" 메뉴 표시 (관리 권한)

---

### UC-05: 정기 모임 참석 투표 (NEW)

**액터**: 리더
**전제조건**: 챌린지 활성화 상태
**성공 시나리오**:

1. 리더가 챌린지 홈 → "투표" 탭
2. "정기 모임 만들기" 클릭
3. 정기 모임 정보 입력
   - 제목: "2월 독서 모임"
   - 날짜: 2026-02-10 14:00
   - 장소: "강남역 스터디카페 A"
   - ❌ 예상 비용 기재 안 함 (비용은 별도 지출 투표로 처리)
   - 설명: "2월에 읽은 책 토론"
4. "투표 시작" 클릭
5. 시스템이 투표 생성 (MEETING_ATTENDANCE 타입)
   - ⭐ 필요 참석 수: **과반수** (팔로워 10명의 50%+1 = 6명)
   - 만료 시간: 모임 날짜 1일 전 (2026-02-09 23:59) (P-039)
6. 모든 팔로워에게 투표 알림

**투표 진행**:
7. 팔로워들이 투표 참여 (**참석/불참**)
8. 참석 6명 달성 → 자동 승인
9. **MEETINGS 테이블에 레코드 생성**
10. 투표 발의자(리더) 자동 참석 등록
11. 정기 모임 확정 알림

> ⚠️ **왜 과반수 참석이 필수인가?**
>
> 과반수 이하에서도 모임이 개최된다면, 리더가 "본인만 참석 가능한 날짜"를
> 파악한 뒤 해당 날짜에 누적 금액 전액을 사용하거나 인출 후 도주하는
> "먹튀" 현상이 발생할 수 있습니다. **"금전적으로 신뢰할 수 있는" 서비스 구조를 위한 안전장치입니다.**

**사후조건**:
- VOTES 레코드 생성 (type: MEETING_ATTENDANCE, status: APPROVED)
- MEETINGS 레코드 생성 (status: CONFIRMED)
- 리더가 MEETING_ATTENDEES에 등록됨
- 다른 팔로워들은 참석 신청 가능

**대안 시나리오**:
- 8a. 과반수 참석 미달 → **모임 자동 취소** (CANCELLED)
- 8b. 3일 후 미달 → 만료 (EXPIRED)

---

### UC-05-1: 정기 모임 취소 (NEW)

**액터**: 리더
**전제조건**: 모임 확정 상태 (CONFIRMED), 모임 시작 1일 전
**성공 시나리오**:

1. 리더가 챌린지 홈 → "정기 모임" 탭
2. 확정된 모임 클릭 (예: "2월 독서 모임")
3. 모임 상세 화면에서 "모임 취소" 버튼 클릭
4. 취소 사유 입력 모달 표시
   ```
   ⚠️ 모임 취소

   모임을 취소하는 이유를 입력해주세요.
   (참석자들에게 전달됩니다)

   [사유 입력]
   예: 개인 사정으로 불참하게 되어 모임을 취소합니다.

   [취소]  [확인]
   ```
5. 취소 사유 입력 후 "확인" 클릭
6. 시스템이 모임 상태 변경: CANCELLED
7. 모든 참석자에게 취소 알림 전송
   - 알림 내용: "리더가 모임을 취소했습니다. 사유: ..."
8. 연결된 지출 투표 모두 자동 거부 (REJECTED)

**사후조건**:
- MEETINGS 상태: CANCELLED
- 참석자 목록 유지 (히스토리 보관)
- 연결된 지출 투표: REJECTED
- 모임 목록에서 "(취소됨)" 표시

**대안 시나리오**:
- 3a. 모임 시작 24시간 이내 → "모임 당일에는 취소할 수 없습니다" 에러
- 3b. 이미 취소된 모임 → "취소" 버튼 미표시

> 💡 **왜 모임 취소 기능이 필요한가?**
>
> 리더가 피치못할 사정으로 불참하는 경우, 챌린지 금고 지출 권한은
> 리더에게 있으므로 리더 없이 모임을 진행할 수 없습니다.
> 이 경우 모임을 취소하고 재일정을 잡을 수 있어야 합니다.

---

### UC-06: 정기 모임 참석 신청

**액터**: 팔로워
**전제조건**: **챌린지 멤버**, 정기 모임 확정됨 (CONFIRMED)
**성공 시나리오**:

1. 팔로워가 챌린지 홈 → "정기 모임" 탭
2. "2월 독서 모임" 클릭
3. **시스템이 멤버 여부 및 권한 상태 확인**
   - 멤버 여부: ✅ 챌린지 멤버
   - 권한 상태 (privilege_status): ✅ ACTIVE
4. 정기 모임 상세 확인
   - 날짜: 2026-02-10 14:00
   - 장소: 강남역 스터디카페 A
   - 참석 인원: 3/10명
5. "참석하기" 클릭
6. 참석자 목록에 추가
7. 정기 모임 당일 알림 예약

**사후조건**:
- MEETING_ATTENDEES 레코드 생성
- 참석 인원 +1
- 정기 모임 당일 알림 예약

**대안 시나리오**:
- **3a. 비회원 또는 비멤버** → 접근 차단
  - 에러 메시지: "챌린지 멤버만 모임에 참석할 수 있습니다"
  - 챌린지 참여 안내 (UC-02)
- **3b. 권한 박탈 상태 (privilege_status = REVOKED)** → 접근 차단 (P-029, P-045)
  - 에러 메시지:
    ```
    ⚠️ 보증금 충전이 필요합니다

    서포트 미납으로 정기 모임 참석이 제한되었습니다.
    보증금을 충전하면 즉시 권한이 복구됩니다.

    남은 유예 기간: 5일
    (유예 기간 경과 시 모임 자동 제외)

    [충전하기]  [닫기]
    ```
  - "충전하기" 클릭 → 충전 화면 이동
  - 충전 완료 → 보증금 락 복구 → privilege_status = ACTIVE
  - 권한 복구 → 정기 모임 참석 가능
- 5a. 최대 인원 초과 → "참석 인원이 마감되었습니다"
- 참석 취소도 가능 (정기 모임 1일 전까지)

> 💡 **비회원 접근 제어**:
> - 정기 모임 상세 페이지는 챌린지 멤버만 접근 가능
> - 비멤버가 URL로 직접 접근 시에도 차단
> - 챌린지 참여 후 모임 참석 가능

---

### UC-07: 오픈 사용 투표 (지출 승인)

**액터**: 리더 또는 팔로워 (발의자), **모임 참석자** (투표자)
**전제조건**: 챌린지 활성화 상태, 정기 모임 관련 지출일 경우 해당 모임 참석자여야 함
**성공 시나리오**:

**발의**:
1. 리더가 "투표" 탭 → "오픈 사용 신청하기"
2. 지출 정보 입력
   - 항목: "2월 모임 장소 대관료"
   - 금액: 50,000원
   - 영수증: 사진 업로드
   - 설명: "스터디카페 4시간 대관"
   - ⭐ 관련 모임 선택 (선택사항): "2월 독서 모임"
3. "투표 시작" 클릭
4. 시스템이 투표 생성 (EXPENSE 타입)
   - 필요 찬성 수: 5명
   - 만료 시간: 3일 후
   - ⭐ meeting_id 연결 (모임 관련 지출일 경우)

**투표 진행** (P-037, P-042):

**[일반 지출 투표]** (meeting_id 없음):
7. 전체 챌린지 멤버에게 투표 알림
8. 멤버들이 찬성/반대 투표
   - 투표 참여자: 전체 챌린지 멤버 10명
   - 필요 찬성: 과반수 (6명)
9. 과반수 달성 → **자동 승인**

**[모임 관련 지출 투표]** (meeting_id 있음) (P-042, P-044):
7. **해당 모임 참석자에게만 투표 알림**
8. **참석자만 찬성/반대 투표 가능**
   - 투표 참여자: 모임 참석자 8명만 (전체 멤버 10명 X)
   - 필요 찬성: 참석자 과반수 (5명)
   - 비참석자는 투표 참여 불가
9. 참석자 과반수 달성 → **자동 승인**

> ⚠️ **모임 관련 지출 투표 규칙**
>
> 정기 모임 관련 지출은 **해당 모임에 참석한 멤버만** 투표할 수 있습니다.
> 참석하지 않은 멤버는 해당 지출에 대한 의결권이 없습니다.
>
> 일반 챌린지 지출 (모임 무관)은 전체 멤버가 투표합니다.

**승인 후 처리** (트랜잭션):
10. 투표 상태 변경: APPROVED
11. 거래 내역 기록 생성 (LEDGER_ENTRIES)
12. 챌린지 금고 차감: 3,375,000 → 3,325,000원
13. 투표-장부 연결 (vote.ledger_entry_id)
14. 모든 참석자에게 승인 알림

**사후조건**:
- 투표 상태: APPROVED
- 거래 내역 기록 생성
- 챌린지 잔액 차감
- 장부 탭에서 기록 확인 가능

**대안 시나리오**:
- 8a. 모임 관련 지출인데 비참석자가 투표 시도 → "모임 참석자만 투표할 수 있습니다" 에러
- 9a. 반대 다수 → 자동 거부 (REJECTED)
- 10a. 챌린지 잔액 부족 → 승인 실패, 투표 상태 PENDING 유지

---

### UC-08: 장부 확인 & Django 분석

**액터**: 리더 또는 팔로워
**전제조건**: 챌린지 멤버
**성공 시나리오**:

1. 챌린지 홈 → "거래 내역" 탭 클릭
2. **시스템이 자동으로 Django 분석 트리거** (<<include>> 관계)
   - 사용자는 별도 "분석 요청" 버튼 클릭 불필요
   - Spring Boot가 거래 내역 데이터 조회 (Oracle DB)
   - Spring Boot → Django로 JSON 전송 (REST API)
   - Django가 pandas로 데이터 분석 실행
   - Django → Spring Boot로 분석 결과 반환
   - **분석 결과 캐싱** (TTL: 5분)
3. **분석 결과 + 차트 동시 표시**
   ```
   📊 1월 거래 요약

   총 지출: 300,000원
   평균 일일 지출: 10,000원
   전월 대비: 15% 감소 ↓

   [Line Chart: 월별 지출 추이]
   [Pie Chart: 카테고리별 비율]
   ```
4. 거래 내역 타임라인 렌더링
   - 2월 10일: 모임 장소 대관료 -50,000원
   - 2월 5일: 이영희 입회비 +375,000원
   - ...

**사후조건**:
- 분석 결과 화면에 표시
- Recharts 차트 렌더링
- 분석 결과 캐시 저장 (5분)

**대안 시나리오**:
- **2a. 캐시 유효** (5분 이내 재방문) → Django 호출 스킵, 캐시 데이터 사용
- **2b. Django 응답 실패** → 거래 내역만 표시, 차트 섹션 숨김, "분석 중 오류 발생" 안내

> 💡 **차트 데이터 조회 플로우**:
> - ❌ 사용자가 "차트 데이터 조회"로 직접 접근 불가
> - ✅ 반드시 "거래 내역 탭" → Django 분석 → 차트 표시 순서
> - 이를 통해 항상 최신 분석 데이터 보장

> 💡 **UML 다이어그램 관계**:
> - 거래 내역 조회 --`<<include>>`--> Django 분석 요청 (필수)
> - Django 분석 요청 --`<<include>>`--> 차트 데이터 조회 (필수)
> - 차트는 Django 분석 없이 조회 불가

---

### UC-09: 챌린지 탈퇴 (보증금 락 해제)

**액터**: 팔로워 또는 시스템 (자동 탈퇴)
**전제조건**: 챌린지 멤버

**[시나리오 A] 정상 탈퇴 (미납금 없음)**:

1. 챌린지 홈 → 설정 → "챌린지 나가기"
2. 탈퇴 확인 모달
   ```
   ⚠️ 챌린지 탈퇴

   탈퇴 시 처리:
   ✅ 보증금 락 해제: 100,000 크레딧 → 가용 크레딧
   ❌ 입회비 375,000 크레딧 미반환
   ❌ 탈퇴 후 피드 열람 불가

   정말 탈퇴하시겠습니까?
   ```
3. "탈퇴" 확인
4. 시스템이 처리
   - 보증금 락 해제: 개인 어카운트에서 잠금 상태 해제
   - 거래 내역 기록: "보증금 락 해제"
   - 챌린지 멤버에서 제외 (left_at 기록)
5. 탈퇴 완료 → 홈 화면으로 이동

**[시나리오 B] 미납으로 인한 자동 탈퇴**:

1. 서포트 미납 발생 → 보증금에서 자동 납입 (안심결제)
2. 시스템이 "보증금 충전이 필요합니다" 안내 지속 노출
3. **일정 기간(예: 60일) 미충전 시** (P-017, P-029)
4. 시스템이 자동 탈퇴 처리
   - 보증금 잔액 확인: 이미 서포트 납입에 사용됨 (0원)
   - 챌린지 멤버에서 제외 (left_at 기록)
   - **리더에게만 알림**: "김철수님이 미납으로 탈퇴 처리되었습니다"
5. 탈퇴 처리된 팔로워는 챌린지 접근 불가

**사후조건**:
- [정상 탈퇴] 보증금 락 해제 → 가용 크레딧으로 복귀
- [미납 탈퇴] 보증금은 이미 서포트에 사용됨 (반환 없음)
- 챌린지 멤버 목록에서 제외
- 챌린지 홈 접근 불가

**대안 시나리오**:
- 2a. 미납금 존재 (보증금으로 충당 가능) → "미납금을 납부해주세요" 에러
- 2b. 진행 중인 투표 존재 → "투표 종료 후 탈퇴 가능"

> 💡 **보증금은 예치금**
> 보증금은 미납 시 서포트를 충당하기 위한 예치금입니다.
> 미납 없이 탈퇴하면 락 해제되어 가용 크레딧으로 복귀합니다.

---

### UC-09-1: 보증금 충당으로 인한 권한 박탈 (NEW)

**액터**: 시스템 (자동), 팔로워
**전제조건**: 서포트 납입일, 크레딧 부족
**트리거**: 매월 1일 00:00 서포트 자동 납입
**성공 시나리오**:

1. 시스템이 매월 1일 서포트 자동 차감 시도
2. 크레딧 잔액 부족 확인 (예: 50,000원, 필요: 100,000원)
3. **보증금에서 자동 충당** (안심결제)
   - 보증금 락: 100,000원 → 50,000원
   - 서포트 납입 완료
4. **즉시 권한 박탈 처리** (P-029)
   - privilege_status: ACTIVE → REVOKED
   - privilege_revoked_at: 현재 시각 기록
5. 팔로워에게 알림 지속 노출
   ```
   ⚠️ 보증금 충전이 필요합니다

   서포트 납입을 위해 보증금을 사용했습니다.
   60일 이내 충전하지 않으면 자동 탈퇴됩니다.

   남은 기간: 59일
   보증금 부족분: 50,000원

   [지금 충전하기]
   ```

**권한 박탈 상태 제한** (P-029, P-045):
- ❌ 정기 모임 참석 투표 불가 (UC-05, MEETING_ATTENDANCE)
- ❌ 정기 모임 관련 지출 투표 불가 (UC-07, EXPENSE + meeting_id)
- ❌ 정기 모임 참석 신청 불가 (UC-06)
- ✅ 피드 열람/작성 가능 (UC-03)
- ✅ 댓글 작성 가능 (UC-04)
- ✅ 일반 투표 참여 가능 (UC-07, EXPENSE without meeting_id)

**7일 유예 기간** (P-029):
- 7일 내: 정기 모임 참석 가능 (제한적)
- 7일 경과: 예정된 모임 전체에서 자동 제외
- 참석 등록된 모임에서 자동 삭제

**복구 시나리오**:
6. 팔로워가 "지금 충전하기" 클릭
7. 충전 화면으로 이동
8. 최소 50,000원 충전 (부족분)
9. 시스템이 **보증금 락 1순위 복구**
   - 보증금 락: 50,000원 → 100,000원
10. **즉시 권한 복구**
    - privilege_status: REVOKED → ACTIVE
    - privilege_revoked_at: NULL
11. "권한이 복구되었습니다" 알림
    ```
    ✅ 권한이 복구되었습니다

    보증금이 충전되어 정기 모임 참석이 가능합니다.
    ```

**자동 탈퇴 조건** (P-017):
- privilege_revoked_at 기준 **60일** 경과
- 보증금 락 미충족 상태 유지
- 시스템이 자동 탈퇴 처리 (UC-09 시나리오 B)

**사후조건**:
- [복구 시] privilege_status = ACTIVE, 정기 모임 참석 가능
- [미복구 60일] 자동 탈퇴 (UC-09 시나리오 B)

> 💡 **권한 박탈의 목적**:
>
> 보증금은 미납 대비 예치금입니다. 보증금을 사용한 경우
> 다시 충전하도록 유도하기 위해 정기 모임 참석을 제한합니다.
> 피드/댓글 등 SNS 활동은 제한하지 않아 챌린지 참여 의지를 유지시킵니다.

---

### UC-10: 챌린지 완주 (인증 마크 부여)

**액터**: 시스템 (자동)
**전제조건**: 챌린지 ACTIVE 상태 1년 유지
**트리거**: activated_at (ACTIVE 전환 시점) 기준 365일 경과

**성공 시나리오**:

1. 시스템이 **activated_at 기준 1년 경과** 확인
2. 챌린지 상태가 **ACTIVE 또는 PAUSED**인 경우에만 인증 부여
   (CLOSED 상태는 인증 부여 불가)
3. **챌린지에 인증 마크 자동 부여**
   ```
   🏆 챌린지 완주!

   "책벌레들" 챌린지가 1년 연속 운영을 달성했습니다.
   
   ✅ 인증 마크가 부여되었습니다.
   
   챌린지는 계속 운영되며, 서포트도 지속됩니다.
   ```
4. 챌린지 상태에 `VERIFIED` 플래그 추가
5. 모든 팔로워에게 완주 축하 알림
6. 챌린지 홈에 인증 마크(🏆) 표시

**사후조건**:
- 챌린지에 인증 마크 부여 (블루체크 컨셉)
- 챌린지는 **계속 운영됨** (해체 ❌)
- 서포트(납입) 지속됨
- 보증금 변동 없음 (완주와 보증금은 무관)

> 💡 **완주 = 인증 (계 해체 아님)**
> 모임형 계는 종료 개념이 없습니다. 완주는 1년 연속 운영을
> 달성한 챌린지에 신뢰성 인증 마크를 부여하는 것입니다.
> 인스타그램 블루체크와 유사한 개념입니다.

---

### UC-11-1: 리더 강퇴 투표 (LEADER_KICK) (NEW)

**액터**: 팔로워 (발의자), 전체 팔로워 (투표자)
**전제조건**: **리더 30일 이상 미활동** (P-033, P-040)
**성공 시나리오**:

**미활동 감지**:
1. 시스템이 리더 최근 활동 확인
   - 기준: 피드 작성, 투표 생성, 댓글 작성, 정기 모임 생성
   - leader_last_active_at 기준 30일 경과
2. 팔로워 화면에 **"리더 강퇴 요청" 버튼 활성화**

**강퇴 투표 발의**:
3. 팔로워가 "리더 강퇴 요청" 버튼 클릭
4. 강퇴 사유 입력 모달 표시
   ```
   ⚠️ 리더 강퇴 투표

   리더가 30일 이상 활동하지 않았습니다.
   강퇴 사유를 입력해주세요.

   [사유 입력]
   예: 리더가 한 달 이상 활동하지 않아 챌린지 운영이 어렵습니다.

   최소 20자 이상 입력해주세요.

   [취소]  [투표 시작]
   ```
5. 사유 입력 후 "투표 시작" 클릭
6. 시스템이 투표 생성 (LEADER_KICK 타입)
   - 필요 찬성 비율: **70% 이상** (P-040)
   - 만료 시간: 7일 후
   - 투표 대상자: 전체 팔로워 (리더 제외)
7. 전체 팔로워에게 투표 알림 (리더에게도 알림 발송)

**투표 진행**:
8. 팔로워들이 찬성/반대 투표
9. **70% 이상 찬성** → 자동 승인
10. **리더 승계 처리** (P-034, P-051)
    - 부리더(sub_leader_id)가 있으면 → 부리더에게 리더 양도
    - 부리더가 없으면 → 전체 통합 점수(total_score) 최고자에게 양도
11. 기존 리더 **일반 팔로워로 전환**
    - role: LEADER → FOLLOWER
    - 리더 권한 모두 제거
12. 모든 멤버에게 "리더가 변경되었습니다" 알림
    ```
    👑 리더가 변경되었습니다

    기존 리더: 김철수
    새 리더: 이영희 (점수: 87.5점)

    💡 새 리더는 점수 기반으로 자동 선정되었습니다.
    ```

**사후조건**:
- 투표 상태: APPROVED (70% 이상) 또는 REJECTED
- 기존 리더: 일반 팔로워로 전환
- 새 리더: 점수 최고자 (또는 부리더)
- 챌린지 운영 지속

**대안 시나리오**:
- 9a. 70% 미만 찬성 → 투표 자동 거부 (REJECTED)
- 9b. 7일 후 미달 → 만료 (EXPIRED)
- 3a. 리더 활동 30일 미만 → "리더 강퇴 요청" 버튼 미표시

> 💡 **리더 강퇴의 목적**:
>
> 리더가 장기간 미활동 시 챌린지 운영이 어려워집니다.
> 팔로워들의 70% 이상 동의 시 리더를 교체하여
> 챌린지가 지속적으로 운영될 수 있도록 합니다.

---

### UC-11: 멤버 퇴출 투표 (KICK) (NEW)

**액터**: 리더 또는 팔로워 (발의자), 전체 멤버 (투표자)
**전제조건**: 챌린지 활성화 상태
**성공 시나리오**:

1. 발의자가 "투표" 탭 → "멤버 퇴출 투표" 클릭
2. 퇴출 대상 멤버 선택
   - 드롭다운에서 챌린지 멤버 목록 표시 (본인 제외)
3. 퇴출 사유 입력
   ```
   퇴출 투표 사유

   대상: 김철수

   [사유 입력]
   예: 지속적인 활동 부재로 챌린지 참여가 어렵습니다.

   최소 20자 이상 입력해주세요.
   ```
4. "투표 시작" 클릭
5. 시스템이 투표 생성 (KICK 타입)
   - **필요 찬성 비율: 70% 이상**
   - 만료 시간: 7일 후
   - 대상 멤버는 투표 참여 불가
6. 전체 멤버에게 투표 알림 (대상 멤버 포함)

**투표 진행**:
7. 멤버들이 투표 참여 (찬성/반대)
8. 70% 이상 찬성 달성 → **자동 승인**
9. 대상 멤버 **강제 탈퇴 처리**
   - 보증금 반환 (정상 탈퇴와 동일)
   - 챌린지 접근 차단
   - 모든 멤버에게 "김철수님이 퇴출되었습니다" 알림

**사후조건**:
- 투표 상태: APPROVED (70% 이상) 또는 REJECTED
- 대상 멤버 탈퇴 처리 (승인 시)
- 보증금 반환 완료

**대안 시나리오**:
- 8a. 70% 미만 찬성 → 투표 자동 거부 (REJECTED)
- 8b. 7일 후 미달 → 만료 (EXPIRED)
- 2a. 리더를 퇴출 대상으로 선택 → "리더는 퇴출 대상이 될 수 없습니다" 에러

> 💡 **왜 70%가 필요한가?**
>
> 멤버 퇴출은 강력한 조치이므로 과반수(50%)보다 높은 합의가 필요합니다.
> 70% 이상의 찬성이 있어야 퇴출이 정당하다고 판단합니다.

---

### UC-12: 규칙 변경 투표 (RULE_CHANGE) (NEW)

**액터**: 리더 (발의자), 전체 멤버 (투표자)
**전제조건**: 챌린지 활성화 상태
**성공 시나리오**:

1. 리더가 "투표" 탭 → "규칙 변경 투표" 클릭
2. 규칙 변경 내용 입력
   ```
   규칙 변경 투표

   [기존 규칙]
   매주 1권 필독

   [변경 규칙]
   격주 1권 필독

   [변경 사유]
   멤버들의 일정이 바빠져 주간 독서가 부담된다는
   의견이 많아 격주로 조정하고자 합니다.
   ```
3. "투표 시작" 클릭
4. 시스템이 투표 생성 (RULE_CHANGE 타입)
   - **필요 찬성 비율: 과반수 (50% + 1)**
   - 만료 시간: 5일 후
5. 전체 멤버에게 투표 알림

**투표 진행**:
6. 멤버들이 투표 참여 (찬성/반대)
7. 과반수 찬성 달성 → **자동 승인**
8. **챌린지 규칙 변경 적용**
   - 챌린지 설명에 "(규칙 변경됨)" 표시
   - 모든 멤버에게 "규칙이 변경되었습니다" 알림

**사후조건**:
- 투표 상태: APPROVED 또는 REJECTED
- 챌린지 규칙 변경 (승인 시)
- 변경 이력 기록

**대안 시나리오**:
- 7a. 과반수 미만 찬성 → 투표 자동 거부 (REJECTED)
- 7b. 5일 후 미달 → 만료 (EXPIRED)
- 1a. 팔로워가 규칙 변경 투표 시도 → "리더만 규칙 변경 투표를 시작할 수 있습니다" 에러

> 💡 **리더만 발의 가능**:
>
> 규칙 변경은 챌린지 운영 방향을 바꾸는 중요한 결정이므로
> 리더만 발의할 수 있으며, 전체 멤버의 과반수 동의가 필요합니다.

---

### UC-13: 챌린지 종료 투표 (DISSOLVE) (NEW)

**액터**: 리더 (발의자), 전체 멤버 (투표자)
**전제조건**: 챌린지 ACTIVE 상태
**성공 시나리오**:

1. 리더가 "투표" 탭 → "챌린지 종료 투표" 클릭
2. 종료 사유 입력 모달 표시
   ```
   ⚠️ 챌린지 종료 투표

   챌린지를 종료하려면 전원 동의가 필요합니다.
   1명이라도 반대하면 종료되지 않습니다.

   [종료 사유]
   예: 멤버들의 일정이 맞지 않아 챌린지를 종료하고자 합니다.

   최소 20자 이상 입력해주세요.

   [취소]  [투표 시작]
   ```
3. 사유 입력 후 "투표 시작" 클릭
4. 시스템이 투표 생성 (DISSOLVE 타입)
   - 필요 찬성: **전원 (100%)** (P-041)
   - 만료 시간: 7일 후
5. 전체 멤버에게 투표 알림

**투표 진행**:
6. 멤버들이 동의/반대 투표
7. **전원 동의** → 자동 승인
8. **챌린지 종료 처리** (P-049, P-050)
   - 챌린지 상태 변경: CLOSED
9. **잔액 분배 처리**
   - 챌린지 금고 잔액: 3,000,000원
   - 멤버 수: 10명 (리더 포함)
   - 1인당 분배액: 300,000원
   - 각 멤버 어카운트로 자동 이체
   - 거래 내역 기록: "챌린지 종료 잔액 분배"
10. 모든 멤버에게 "챌린지가 종료되었습니다" 알림
    ```
    🏁 챌린지가 종료되었습니다

    챌린지 금고 잔액이 모든 멤버에게 균등 분배되었습니다.
    분배 금액: 300,000원

    💡 챌린지 홈은 읽기 전용으로 유지됩니다.
    ```

**사후조건**:
- 챌린지 상태: CLOSED
- 챌린지 금고 잔액: 0원 (전액 분배)
- 각 멤버 어카운트: +300,000원
- 챌린지 홈: 읽기 전용 유지 (히스토리 보관)
- 신규 가입: 불가

**대안 시나리오**:
- **7a. 1명이라도 반대** → 투표 자동 거부 (REJECTED)
  - "전원 동의가 필요합니다. 1명이 반대했습니다." 메시지
- 7b. 7일 후 미달 → 만료 (EXPIRED)
- 1a. 팔로워가 종료 투표 시도 → "리더만 챌린지 종료 투표를 시작할 수 있습니다" 에러

**특수 케이스** (P-035):
```
[전원 자동 탈퇴로 종료]
- 모든 멤버가 자동 탈퇴 시 챌린지 자동 CLOSED
- 잔액 분배 없음 → 우리두 귀속
```

> 💡 **전원 동의가 필요한 이유**:
>
> 챌린지 종료는 모든 멤버의 참여를 중단시키는 중대한 결정입니다.
> 소수 의견도 존중하기 위해 전원 동의를 필요로 합니다.
> 1명이라도 반대하면 챌린지는 계속 운영됩니다.

---

## 📊 유스케이스 매트릭스

### 기능별 우선순위

| UC ID | 유스케이스 | 액터 | 우선순위 | Demo Day | 비고 |
|-------|----------|------|---------|----------|------|
| UC-01 | 챌린지 생성 | 리더 | P0 | ✅ 필수 | 리더 자동 가입 포함 |
| UC-02-0 | 챌린지 상세 모달 조회 | 모두 | P0 | ✅ 필수 | 메인페이지 배너 클릭 |
| UC-02 | 챌린지 참여 | 팔로워 | P0 | ✅ 필수 | 입회비, 충전 플로우 포함 |
| UC-03 | SNS 피드 작성 | 모두 | P0 | ✅ 필수 | |
| UC-03-1 | 공지사항 수정/삭제 | 리더 | P1 | ⏳ 선택 | NEW |
| UC-04 | 댓글 작성 | 모두 | P0 | ✅ 필수 | |
| UC-04-1 | 댓글/대댓글 삭제 | 작성자 | P1 | ⏳ 선택 | NEW, Soft delete |
| UC-05 | 정기 모임 생성 투표 | 리더 | P1 | ✅ 필수 | |
| UC-05-1 | 정기 모임 취소 | 리더 | P2 | ⏳ 선택 | NEW |
| UC-06 | 정기 모임 참석 | 팔로워 | P1 | ✅ 필수 | 멤버 접근 제어 추가 |
| UC-07 | 오픈 사용 투표 | 모두 | P0 | ✅ 필수 | |
| UC-08 | 장부 & Django 분석 | 모두 | P0 | ✅ 필수 | 차트 <<include>> 관계 |
| UC-09 | 챌린지 탈퇴 | 팔로워 | P2 | ⏳ 선택 | 60일 자동 탈퇴 |
| UC-09-1 | 보증금 충당 권한 박탈 | 시스템 | P1 | ✅ 필수 | NEW, P-029, 7일 유예 |
| UC-10 | 챌린지 완주 | 리더 | P2 | ⏳ 선택 | |
| UC-11-1 | 리더 강퇴 투표 (LEADER_KICK) | 팔로워 | P2 | ⏳ 선택 | NEW, 70% 찬성, 30일 미활동 |
| UC-11 | 멤버 퇴출 투표 (KICK) | 모두 | P2 | ⏳ 선택 | NEW, 70% 찬성 필요 |
| UC-12 | 규칙 변경 투표 | 리더 | P2 | ⏳ 선택 | NEW, 과반수 필요 |
| UC-13 | 챌린지 종료 투표 (DISSOLVE) | 리더 | P2 | ⏳ 선택 | NEW, 전원 동의 (100%) |

### Demo Day 시연 순서

```
1. [1.0분] UC-02-0 → UC-02 챌린지 참여 플로우 (모달 → 참여 → 충전)
2. [1.5분] UC-03 SNS 피드 작성
3. [1.5분] UC-08 장부 & Django 분석 (차트 포함)
4. [1.5분] UC-05/06 정기 모임 생성 → 참석
5. [0.5분] UC-07 오픈 사용 투표
```

---

**문서 버전**: v2.1
**최종 수정**: 2026-01-08
**작성자**: Claude (Sonnet 4.5)
**관련 문서**:
- [Product Agenda](../Product/PRODUCT_AGENDA.md)
- [IA Specification](../UX_UI/IA_SPECIFICATION.md)
- [Policy Changes](./POLICY_CHANGES.md)
